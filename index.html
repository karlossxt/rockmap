<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeRadar PRO - Zonificaci칩n Musical</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --primary: #ff3e3e; --spotify: #1DB954; --glass: rgba(255, 255, 255, 0.9); }
        body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; background: #000; color: white; }
        #map { height: 100vh; width: 100%; }

        /* Panel Lateral */
        .info-panel {
            position: absolute; top: 20px; left: 20px; z-index: 1000;
            background: var(--glass); padding: 20px; border-radius: 20px;
            width: 280px; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            backdrop-filter: blur(10px); color: #111;
        }

        /* Widget de Estad칤sticas de Zona */
        .stats-box {
            margin-top: 15px; padding: 15px; background: #000;
            border-radius: 12px; color: #fff; display: none;
        }

        /* Animaci칩n de iconos */
        .genre-icon {
            font-size: 24px; transition: 0.3s; cursor: pointer;
            animation: pulse 2.5s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        
        /* Bot칩n Spotify */
        .btn-spotify {
            background: var(--spotify); color: white; text-decoration: none;
            padding: 5px 12px; border-radius: 15px; font-size: 11px; font-weight: bold;
            display: inline-block; margin-top: 5px;
        }
    </style>
</head>
<body>

    <div class="info-panel">
        <h1 style="margin:0; font-size: 24px;">游니 VibeRadar <span style="font-size:10px; vertical-align: middle; background:red; color:white; padding:2px 5px; border-radius:5px;">PRO</span></h1>
        <p style="font-size: 12px; color: #555;">Toca una zona para ver su actividad.</p>
        
        <button onclick="findMe()" style="width:100%; padding:10px; border-radius:8px; border:none; background:var(--primary); color:white; font-weight:bold; cursor:pointer;">游늸 MI UBICACI칍N</button>

        <div id="statsBox" class="stats-box">
            <h3 id="zonaNombre" style="margin:0; color: var(--primary);">Zona</h3>
            <p id="zonaData" style="font-size: 13px; margin: 10px 0 0 0;"></p>
        </div>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        const map = L.map('map').setView([19.42, -99.15], 12);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

        // 1. DEFINICI칍N DE ZONAS (GeoJSON Simplificado)
        // En un proyecto real, cargar칤as un archivo .json con las alcald칤as completas
        const zonasGeoJSON = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": { "name": "Cuauht칠moc", "bands": 12, "venues": 8 },
                    "geometry": { "type": "Polygon", "coordinates": [[[ -99.18, 19.40 ], [ -99.12, 19.40 ], [ -99.12, 19.46 ], [ -99.18, 19.46 ], [ -99.18, 19.40 ]]] }
                },
                {
                    "type": "Feature",
                    "properties": { "name": "Benito Ju치rez", "bands": 5, "venues": 4 },
                    "geometry": { "type": "Polygon", "coordinates": [[[ -99.19, 19.35 ], [ -99.14, 19.35 ], [ -99.14, 19.40 ], [ -99.19, 19.40 ], [ -99.19, 19.35 ]]] }
                }
            ]
        };

        // 2. ESTILO Y COMPORTAMIENTO DE LAS ZONAS
        function styleZona(feature) {
            return {
                fillColor: feature.properties.venues > 5 ? '#ff3e3e' : '#3498db',
                weight: 2, opacity: 1, color: 'white', dashArray: '3', fillOpacity: 0.2
            };
        }

        function highlightFeature(e) {
            var layer = e.target;
            layer.setStyle({ fillOpacity: 0.5, weight: 3, color: '#f1c40f' });
            layer.bringToFront();
        }

        function resetHighlight(e) {
            zonasLayer.resetStyle(e.target);
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: function(e) {
                    const sb = document.getElementById('statsBox');
                    sb.style.display = 'block';
                    document.getElementById('zonaNombre').innerText = feature.properties.name;
                    document.getElementById('zonaData').innerHTML = `游꿪 Bandas: ${feature.properties.bands}<br>游꽄 Venues: ${feature.properties.venues}`;
                    map.fitBounds(e.target.getBounds());
                }
            });
        }

        const zonasLayer = L.geoJSON(zonasGeoJSON, {
            style: styleZona,
            onEachFeature: onEachFeature
        }).addTo(map);

        // 3. TUS 15 SPOTS REALES
        const spots = [
            { name: "Capitan Gallo", coords: [19.4297, -99.1465], info: "Centro" },
            { name: "Multiforo 246", coords: [19.4129, -99.1661], info: "Roma" },
            { name: "Dobermann", coords: [19.4352, -99.1414], info: "Centro" },
            { name: "Alicia", coords: [19.4475, -99.1558], info: "Sta Mar칤a" },
            { name: "McCarthy's", coords: [19.3901, -99.1764], info: "N치poles" },
            { name: "Cueva De Lobos", coords: [19.4255, -99.1633], info: "Ju치rez" },
            { name: "Sangriento", coords: [19.4678, -99.1872], info: "M. Hidalgo" },
            { name: "Pub de Floki", coords: [19.6262, -99.0921], info: "Coacalco" }
            // ... (a침ade los dem치s aqu칤)
        ];

        spots.forEach(s => {
            const icon = L.divIcon({ className: 'genre-icon', html: "游꽄", iconSize: [30, 30] });
            L.marker(s.coords, { icon: icon })
                .bindPopup(`<b>${s.name}</b><br>${s.info}`)
                .addTo(map);
        });

        // 4. BANDAS (Con seguridad Jitter y Link a Spotify)
        const bandas = [
            { name: "Rencor Metal", type: "游뱆", coords: [19.42, -99.14], spot: "https://open.spotify.com" },
            { name: "Indie Noise", type: "游꿫", coords: [19.43, -99.16], spot: "https://open.spotify.com" }
        ];

        bandas.forEach(b => {
            const jitter = () => (Math.random() - 0.5) * 0.008;
            const icon = L.divIcon({ className: 'genre-icon', html: b.type, iconSize: [30, 30] });
            L.marker([b.coords[0] + jitter(), b.coords[1] + jitter()], { icon: icon })
                .bindPopup(`<b>${b.name}</b><br><a href="${b.spot}" target="_blank" class="btn-spotify">Escuchar en Spotify</a>`)
                .addTo(map);
        });

        function findMe() { map.locate({setView: true, maxZoom: 15}); }
    </script>
</body>
</html>
